YUI.add('item-detail-jhs', function(Y) {	var Lang = Y.Lang,		isDaily = location.href.indexOf('daily.taobao.net') > -1 ? true : false,		formNode = Y.one('#ins_widget_form'),		loadingImg = Y.one('#J_Loading'),		button = Y.one('#J-BuyIns'),		tip = Y.one('#J-tips'),		count = 0;	function submit(callback) {	    var url = formNode.getAttribute('action'),            method = formNode.getAttribute('method'),            timeStamp = +new Date();                             Y.io(url + '?_input_charset=UTF-8', {            method: method.toUpperCase(),            data: 't=' + timeStamp,            on: {                complete: function(id, r) {                    loadingImg.setStyle('display', '');                    tip.removeClass('tip-loaded');                    tip.setContent('<p>正在处理订单中，请稍候...</p>');                    getCalcState();                }            },            form: {                id: formNode            }        });	}		function goToUrl(url, delay) {		Y.later(delay || 3000, null, function() {			location.href = url || (isDaily ? 'http://trade.daily.taobao.net/trade/itemlist/list_bought_items.htm' : 'http://trade.taobao.com/trade/itemlist/list_bought_items.htm');		});	}		function getCalcState() {		var timeStamp = +new Date(),			tmpOrderId = window['tmpOrderId'] || '',			bizOrderId = window['bizOrderId'] || '',			bizOrderIdArr = [],			d;				count++;				Y.io('/json/check_status.html', {			method: 'POST',			data: (bizOrderId ? ('biz_order_id=' + bizOrderId) : ('tmp_order_id=' + tmpOrderId)) + '&t=' + timeStamp,			on: {				complete: function(id, r) {					var res;					try {						res = Y.JSON.parse(r.responseText);					} catch (err) {}										if (res && res.status && res.data) {						count = 0;						var data = res.data;						if (data.length && Lang.isArray(data)) {							//返回订单数与被保人数目相同							while (data.length) {								d = data.shift();								if (d.result) {									bizOrderIdArr.push(d['biz_order_id']);								}							}							if (bizOrderIdArr.length) {								tip.setContent('<p>被保险人核保成功，转向支付宝付款页...</p>');								goToUrl('/order_pay.html?biz_order_id=' + bizOrderIdArr.join(','), 1000);							} else {								//所有订单都核保失败								loadingImg.setStyle('display', 'none');								tip.addClass('tip-loaded');								tip.setContent('<p>订单核保失败，请重新投保。</p>');							}							return;						}					}										//核保未完成					if (count < 7) {						Y.later(1000, null, function() {							getCalcState();						});					} else {						count = 0;						//订单还未处理完成，跳至订单列表页						tip.setContent('<p>转向我的保单订单列表...</p>');						goToUrl('', 1000);					}				}			},			timeout: 1500		});	}		button.on('click', function(e) {		e.preventDefault();		if (button.hasClass('confirming')) { return; }		button.addClass('confirming');		submit();	});}, '0.0.1', {	requires: ['node', 'io', 'json-parse']});